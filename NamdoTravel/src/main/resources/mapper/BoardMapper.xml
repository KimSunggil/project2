<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.project.app.board">
	
	<!-- 		select		 -->
		
	<select id="getPostList" parameterType="int" resultType="PostVO">
		SELECT A.BOARD_ID, B.POST_ID, B.POST_NM, B.USER_NM, B.POST_DATE, B.HITS, B.LIKE, B.DISLIKE
			FROM NAMDODB.BOARD A INNER JOIN NAMDODB.POST B
    		WHERE A.BOARD_ID = #{boardId} ORDER BY B.POST_ID DESC
	</select>
	
	<select id="getPost" parameterType="int" resultType="PostVO">
		SELECT A.BOARD_ID, B.POST_ID, B.POST_NM, B.USER_ID, B.USER_NM, B.POST_DATE, B.HITS, B.LIKE, B.DISLIKE
			FROM NAMDODB.BOARD A INNER JOIN NAMDODB.POST B
    		WHERE B.POST_ID = #{postId} ORDER BY B.POST_ID DESC
	</select>
	
	<select id="getPostContent" parameterType="int" resultType="String">
		SELECT A.CONTENT
			FROM NAMDODB.POST_CONTENT A
			WHERE A.POST_ID = #{postId}
	</select>
	
	<select id="getReplyList" parameterType="int" resultType="ReplyVO">
		SELECT A.REPLY_ID, A.SUPER_REPLY, A.USER_ID, B.NICKNAME, A.CONTENT, A.REPLY_DATE
			FROM NAMDODB.REPLY A INNER JOIN NAMDODB.USER B ON A.USER_ID = B.USER_ID
			WHERE A.POST_ID = #{postId} ORDER BY A.REPLY_ID
	</select>
	
	<!-- 		insert		 -->
	
	<insert id="addPost" parameterType="AddPostVO">
		INSERT INTO NAMDODB.POST( POST_ID, BOARD_ID, USER_ID, USER_NM, POST_NM, POST_DATE, CATEGORY)
			VALUES ((SELECT MAX(A.POST_ID)+1 FROM NAMDODB.POST A), #{boardId}, #{userId}, (SELECT A.NICKNAME FROM NAMDODB.USER A WHERE A.USER_ID = #{userId}), #{postNm}, SYSDATE(), '자유')
	</insert>
	<insert id="addPostContent" parameterType="AddPostVO">
		INSERT INTO NAMDODB.POST_CONTENT(POST_ID, CONTENT)
		    VALUES ((SELECT MAX(A.POST_ID)+1 FROM NAMDODB.POST_CONTENT A), #{postContent})
	</insert>
	
	<insert id="addReply" parameterType="ReplyVO">
		INSERT INTO NAMDODB.REPLY(REPLY_ID, POST_ID, SUPER_REPLY, USER_ID, CONTENT, REPLY_DATE)
			VALUE ((SELECT MAX(A.REPLY_ID)+1 FROM NAMDODB.REPLY A), #{postId}, #{superReply}, #{userId}, #{content}, now())
	</insert>
	
	<!-- 		update		 -->
	<update id="modifyPost" parameterType="PostVO">
		UPDATE NAMDODB.POST
			SET POST_NM = #{postNm}
			WHERE POST_ID = #{postId}
	</update>
	<update id="modifyPostContent" parameterType="PostVO">
		UPDATE NAMDODB.POST_CONTENT
			SET CONTENT = #{postContent}
			WHERE POST_ID = #{postId}
	</update>
	
	<update id="plusHits" parameterType="int">
		UPDATE NAMDODB.POST
			SET HITS = HITS+1
			WHERE POST_ID = #{postId}
	</update>
	<update id="plusLike" parameterType="int">
		UPDATE NAMDODB.POST
			SET LIKE = LIKE+1
			WHERE POST_ID = #{postId}
	</update>
	<update id="plusDisLike" parameterType="int">
		UPDATE NAMDODB.POST
			SET DISLIKE = DISLIKE+1
			WHERE POST_ID = #{postId}
	</update>
	
	<!-- 		delete		 -->
	<delete id="deletePost" parameterType="int">
		DELETE FROM NAMDODB.POST WHERE POST_ID = #{postId}
	</delete>
	<delete id="deletePostContent" parameterType="int">
		DELETE FROM NAMDODB.POST_CONTENT WHERE POST_ID = #{postId}
	</delete>
</mapper>